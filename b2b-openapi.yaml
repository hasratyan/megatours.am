openapi: 3.1.0
info:
  title: Megatours B2B Gateway API
  version: 1.0.0
  description: |
    Public B2B gateway for Megatours suppliers. All supplier calls are brokered by Megatours.
  license:
    name: Proprietary
    url: https://megatours.cloud
servers:
  - url: https://megatours.cloud
security:
  - bearerAuth: []
paths:
  /v1/health:
    get:
      operationId: getHealth
      summary: Health status
      security: []
      responses:
        "200":
          description: Service status
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  service:
                    type: string
                  timestamp:
                    type: string
                    format: date-time
                  suppliers:
                    type: object
                    properties:
                      aoryx:
                        type: boolean
                      efes:
                        type: boolean
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "503":
          $ref: "#/components/responses/ErrorResponse"
  /v1/destinations:
    get:
      operationId: getDestinations
      summary: List supplier destination codes for hotel search
      x-required-scope: hotels:search
      parameters:
        - name: countryCode
          in: query
          required: false
          schema:
            type: string
            default: AE
            pattern: "^[A-Za-z]{2}$"
          description: ISO 2-letter country code filter (default AE)
        - name: q
          in: query
          required: false
          schema:
            type: string
          description: Free text search by destination name/code
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 1000
            default: 200
      responses:
        "200":
          description: Destination code list
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/DestinationLookupResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
  /v1/hotels/room-details:
    post:
      operationId: postHotelRoomDetails
      summary: Get room options with policies and meal/cancellation facets
      x-required-scope: hotels:search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HotelRoomDetailsRequest"
      responses:
        "200":
          description: Room options and filter facets
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/HotelRoomDetailsResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
  /v1/hotels/info:
    post:
      operationId: postHotelInfo
      summary: Get detailed hotel metadata
      x-required-scope: hotels:search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HotelInfoRequest"
      responses:
        "200":
          description: Hotel information
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/HotelInfoResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
  /v1/hotels/prebook:
    post:
      operationId: postHotelPrebook
      summary: Validate selected room rates and return bookable result
      x-required-scope: hotels:search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HotelsPrebookRequest"
      responses:
        "200":
          description: Prebook result with refreshed room options/facets
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/HotelsPrebookResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "409":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
  /v1/hotels/book:
    post:
      operationId: postHotelBook
      summary: Complete hotel booking with selected rates and guests
      description: |
        Books hotel inventory through Aoryx and optionally processes local services:
        transfer booking, excursion booking, and EFES insurance policy issuance.
        For insurance, partners should send traveler form inputs; EFES internal/default fields are filled server-side.
      x-error-catalog:
        - status: 400
          error: Invalid JSON payload
          when: Request body is not valid JSON.
        - status: 400
          error: "Missing insurance field: territoryCode."
          when: Insurance payload is present but missing required top-level fields (`territoryCode`, `riskAmount`, `riskCurrency`, `travelers`).
        - status: 400
          error: "Incomplete insurance traveler field: travelers[0].passportNumber is required."
          when: Insurance traveler object is present but required traveler/address fields are incomplete.
        - status: 400
          error: Unsupported insurance provider. Expected provider=efes.
          when: Insurance payload has unsupported provider value.
        - status: 400
          error: "Transfer flight details are required: flightNumber and arrivalDateTime."
          when: transferSelection is provided without arrival flight details.
        - status: 400
          error: "Return transfer requires departure flight details: departureFlightNumber and departureDateTime."
          when: transferSelection.includeReturn=true but departure flight details are missing.
        - status: 403
          error: Scope is not allowed for insurance policy issuance
          when: insurance payload is sent without insurance:quote scope.
      x-required-scope: hotels:book
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HotelsBookRequest"
      responses:
        "200":
          description: Booking result
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/HotelsBookResponse"
              examples:
                all_services_booked:
                  $ref: "#/components/examples/HotelsBookAllServicesBooked"
                insurance_failed:
                  $ref: "#/components/examples/HotelsBookInsuranceFailed"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
  /v1/hotels/search:
    post:
      operationId: postHotelSearch
      summary: Search hotels through Aoryx
      x-required-scope: hotels:search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/HotelSearchRequest"
      responses:
        "200":
          description: Search results
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/HotelSearchResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
  /v1/transfers/search:
    post:
      operationId: postTransferSearch
      summary: Search transfer options with facets
      x-required-scope: hotels:search
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TransfersSearchRequest"
      responses:
        "200":
          description: Transfer search result
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/TransfersSearchResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
  /v1/excursions/search:
    post:
      operationId: postExcursionSearch
      summary: Search excursions with facets
      x-required-scope: hotels:search
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ExcursionsSearchRequest"
      responses:
        "200":
          description: Excursion search result
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/ExcursionsSearchResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
  /v1/insurance/quote:
    post:
      operationId: postInsuranceQuote
      summary: Get travel insurance quote through Efes
      x-required-scope: insurance:quote
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/InsuranceQuoteRequest"
      responses:
        "200":
          description: Insurance quote result
          headers:
            x-request-id:
              schema:
                type: string
            x-ratelimit-limit:
              schema:
                type: string
            x-ratelimit-remaining:
              schema:
                type: string
            x-ratelimit-reset:
              schema:
                type: string
          content:
            application/json:
              schema:
                type: object
                properties:
                  requestId:
                    type: string
                  data:
                    $ref: "#/components/schemas/InsuranceQuoteResponse"
        "400":
          $ref: "#/components/responses/ErrorResponse"
        "401":
          $ref: "#/components/responses/ErrorResponse"
        "403":
          $ref: "#/components/responses/ErrorResponse"
        "429":
          $ref: "#/components/responses/ErrorResponse"
        "500":
          $ref: "#/components/responses/ErrorResponse"
        "502":
          $ref: "#/components/responses/ErrorResponse"
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
  examples:
    MissingBearerTokenError:
      summary: Missing bearer token
      value:
        error: Missing bearer token
        requestId: 89eb0ba6-7092-4f90-b369-c3a97010ca0d
    InvalidTransferFlightDetailsError:
      summary: Missing arrival flight details
      value:
        error: "Transfer flight details are required: flightNumber and arrivalDateTime."
        requestId: 20594efb-55d6-410d-84f1-b9de5f1b3254
    MissingInsuranceFieldError:
      summary: Missing top-level insurance field
      value:
        error: "Missing insurance field: territoryCode."
        requestId: 7abf4e8f-4d8b-4e2f-bf1f-a5de55d0c134
    IncompleteInsuranceTravelerFieldError:
      summary: Missing required traveler field
      value:
        error: "Incomplete insurance traveler field: travelers[0].passportNumber is required."
        requestId: 5e0ed3a2-365d-4858-8f4f-02a80d399fb5
    UnsupportedInsuranceProviderError:
      summary: Unsupported insurance provider
      value:
        error: Unsupported insurance provider. Expected provider=efes.
        requestId: c3ea2e86-2f1c-44f7-b9a8-11de66d598dc
    ReturnTransferDepartureDetailsError:
      summary: Missing departure details for return transfer
      value:
        error: "Return transfer requires departure flight details: departureFlightNumber and departureDateTime."
        requestId: c0e68ff5-8c1f-4aa4-bdb4-6adfda1c91ba
    ScopeNotAllowedForInsuranceError:
      summary: Missing insurance scope
      value:
        error: Scope is not allowed for insurance policy issuance
        requestId: fdc0f7fd-d297-4e45-b4f8-96de62d4cc9f
    IpNotAllowedError:
      summary: Caller IP not in allowlist
      value:
        error: Client IP is not allowed
        requestId: 0a042532-4cc3-48f9-afcc-ea9a18534e7f
    HotelsBookAllServicesBooked:
      summary: Hotel and all services booked
      value:
        requestId: 4f18b2a2-0d33-44dd-9f7f-f8a7e95cfc0f
        data:
          sessionId: ""
          status: Confirmed
          hotelConfirmationNumber: HTL-987654
          adsConfirmationNumber: ADS-445566
          supplierConfirmationNumber: SUP-22991
          customerRefNumber: PARTNER-1001
          rooms:
            - roomIdentifier: 1
              rateKey: null
              status: Confirmed
          services:
            transfer:
              status: booked
              referenceId: TRF-20260213121010-ab12cd34
              message: null
            excursions:
              status: booked
              referenceId: EXC-20260213121010-ef56gh78
              message: null
              items: 1
            insurance:
              status: booked
              referenceId: INS-20260213121010-ij90kl12
              message: null
              provider: efes
              policies:
                - travelerId: trav-1
                  response:
                    policy_number: EF-123456
    HotelsBookInsuranceFailed:
      summary: Hotel booked, insurance failed
      value:
        requestId: 5b2e21ad-b9ce-4c7f-9504-c3e533110488
        data:
          sessionId: ""
          status: Confirmed
          hotelConfirmationNumber: HTL-123456
          adsConfirmationNumber: ADS-778899
          supplierConfirmationNumber: SUP-99001
          customerRefNumber: PARTNER-1002
          rooms:
            - roomIdentifier: 1
              rateKey: null
              status: Confirmed
          services:
            transfer:
              status: booked
              referenceId: TRF-20260213121540-aa11bb22
              message: null
            excursions:
              status: skipped
              referenceId: null
              message: null
              items: 0
            insurance:
              status: failed
              referenceId: null
              message: Failed to issue EFES insurance policies.
              provider: efes
              policies: null
  responses:
    ErrorResponse:
      description: Error response
      content:
        application/json:
          schema:
            type: object
            properties:
              error:
                type: string
              requestId:
                type: string
              code:
                type: [string, "null"]
          examples:
            missing_bearer_token:
              $ref: "#/components/examples/MissingBearerTokenError"
            missing_insurance_field:
              $ref: "#/components/examples/MissingInsuranceFieldError"
            incomplete_insurance_traveler_field:
              $ref: "#/components/examples/IncompleteInsuranceTravelerFieldError"
            unsupported_insurance_provider:
              $ref: "#/components/examples/UnsupportedInsuranceProviderError"
            invalid_transfer_flight_details:
              $ref: "#/components/examples/InvalidTransferFlightDetailsError"
            return_transfer_departure_details_required:
              $ref: "#/components/examples/ReturnTransferDepartureDetailsError"
            scope_not_allowed_for_insurance:
              $ref: "#/components/examples/ScopeNotAllowedForInsuranceError"
            ip_not_allowed:
              $ref: "#/components/examples/IpNotAllowedError"
  schemas:
    Room:
      type: object
      properties:
        roomIdentifier:
          type: integer
          minimum: 1
        adults:
          type: integer
          minimum: 1
        childrenAges:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 17
      required:
        - roomIdentifier
        - adults
        - childrenAges
    FacetItem:
      type: object
      properties:
        key:
          type: string
        label:
          type: string
        count:
          type: integer
      required:
        - key
        - label
        - count
    RoomPolicyCondition:
      type: object
      properties:
        fromDate:
          type: [string, "null"]
        toDate:
          type: [string, "null"]
        timezone:
          type: [string, "null"]
        unit:
          type: [number, "null"]
        text:
          type: [string, "null"]
        fromTime:
          type: [string, "null"]
        toTime:
          type: [string, "null"]
        percentage:
          type: [number, "null"]
        nights:
          type: [number, "null"]
        fixed:
          type: [number, "null"]
        applicableOn:
          type: [string, "null"]
    RoomPolicy:
      type: object
      properties:
        type:
          type: [string, "null"]
        textCondition:
          type: [string, "null"]
        currency:
          type: [string, "null"]
        conditions:
          type: array
          items:
            $ref: "#/components/schemas/RoomPolicyCondition"
    RoomRemark:
      type: object
      properties:
        type:
          type: [string, "null"]
        text:
          type: [string, "null"]
    RoomOption:
      type: object
      properties:
        id:
          type: string
        name:
          type: [string, "null"]
        boardType:
          type: [string, "null"]
        refundable:
          type: [boolean, "null"]
        currency:
          type: [string, "null"]
        totalPrice:
          type: [number, "null"]
        displayTotalPrice:
          type: [number, "null"]
        availableRooms:
          type: [number, "null"]
        cancellationPolicy:
          type: [string, "null"]
        meal:
          type: [string, "null"]
        rateKey:
          type: [string, "null"]
          description: Opaque token. Send unchanged to /v1/hotels/prebook.
        groupCode:
          type: [number, "null"]
        roomIdentifier:
          type: [number, "null"]
        rateType:
          type: [string, "null"]
        bedTypes:
          type: array
          items:
            type: string
        inclusions:
          type: array
          items:
            type: string
        policies:
          type: array
          items:
            $ref: "#/components/schemas/RoomPolicy"
        remarks:
          type: array
          items:
            $ref: "#/components/schemas/RoomRemark"
      required:
        - id
    RoomFacets:
      type: object
      properties:
        mealPlans:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        cancellationPolicies:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        rateTypes:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        refundability:
          type: object
          properties:
            refundable:
              type: integer
            nonRefundable:
              type: integer
            unknown:
              type: integer
          required:
            - refundable
            - nonRefundable
            - unknown
        priceRange:
          type: object
          properties:
            min:
              type: [number, "null"]
            max:
              type: [number, "null"]
            currency:
              type: [string, "null"]
          required:
            - min
            - max
            - currency
      required:
        - mealPlans
        - cancellationPolicies
        - rateTypes
        - refundability
        - priceRange
    HotelRoomDetailsRequest:
      type: object
      properties:
        hotelCode:
          type: string
        destinationCode:
          type: string
          description: Supplier destination code, usually in `<number>-0` format.
          example: "160-0"
        countryCode:
          type: string
          default: AE
        nationality:
          type: string
          default: AM
        currency:
          type: string
          default: USD
        checkInDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        checkOutDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/Room"
      required:
        - hotelCode
        - checkInDate
        - checkOutDate
    HotelRoomDetailsResponse:
      type: object
      properties:
        currency:
          type: [string, "null"]
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RoomOption"
        facets:
          $ref: "#/components/schemas/RoomFacets"
      required:
        - rooms
        - facets
    HotelInfoRequest:
      type: object
      properties:
        hotelCode:
          type: string
      required:
        - hotelCode
    HotelInfoResponse:
      type: object
      additionalProperties: true
      description: |
        Normalized hotel metadata including destinationId, systemId, name, rating,
        imageUrl/imageUrls, amenities, address, geoCode, and contact details.
    HotelsPrebookRequest:
      type: object
      properties:
        sessionId:
          type: [string, "null"]
          description: Required when using raw rate keys; optional when using rate tokens.
        hotelCode:
          type: string
        groupCode:
          type: [number, "null"]
          description: Required when using raw rate keys; optional when using rate tokens.
        rateKeys:
          type: array
          items:
            type: string
          description: |
            Rate key tokens returned from /v1/hotels/room-details.
            Raw supplier rate keys are also supported if sessionId and groupCode are provided.
        currency:
          type: [string, "null"]
      required:
        - hotelCode
        - rateKeys
    HotelsPrebookResponse:
      type: object
      properties:
        isBookable:
          type: [boolean, "null"]
        isSoldOut:
          type: [boolean, "null"]
        isPriceChanged:
          type: [boolean, "null"]
        currency:
          type: [string, "null"]
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/RoomOption"
        facets:
          $ref: "#/components/schemas/RoomFacets"
      required:
        - rooms
        - facets
    HotelsBookGuest:
      type: object
      properties:
        title:
          type: string
        titleCode:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        isLeadGuest:
          type: boolean
        type:
          type: string
          enum:
            - Adult
            - Child
        age:
          type: number
      required:
        - firstName
        - lastName
        - type
        - age
    HotelsBookRoomPrice:
      type: object
      properties:
        gross:
          type: number
        net:
          type: number
        tax:
          type: number
      required:
        - gross
        - net
    HotelsBookRoom:
      type: object
      properties:
        roomIdentifier:
          type: integer
          minimum: 1
        adults:
          type: integer
          minimum: 1
        childrenAges:
          type: array
          items:
            type: number
        rateKey:
          type: string
          description: Opaque rate token from /v1/hotels/room-details or /v1/hotels/prebook.
        guests:
          type: array
          items:
            $ref: "#/components/schemas/HotelsBookGuest"
        price:
          $ref: "#/components/schemas/HotelsBookRoomPrice"
      required:
        - roomIdentifier
        - adults
        - rateKey
        - guests
        - price
    HotelsBookRequest:
      type: object
      properties:
        sessionId:
          type: [string, "null"]
          description: Optional when rateKey tokens contain the session.
        hotelCode:
          type: string
        hotelName:
          type: [string, "null"]
        destinationCode:
          type: string
        checkInDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        checkOutDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        countryCode:
          type: string
          default: AE
        nationality:
          type: string
          default: AM
        currency:
          type: string
          default: USD
        customerRefNumber:
          type: string
        groupCode:
          type: [number, "null"]
          description: Optional when rateKey tokens contain the group.
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/HotelsBookRoom"
        transferSelection:
          type: ["null", object]
          description: |
            Local transfer booking payload.
            flightDetails.flightNumber and flightDetails.arrivalDateTime are required.
            If includeReturn is true, departureFlightNumber and departureDateTime are also required.
          properties:
            id:
              type: [string, "null"]
            includeReturn:
              type: boolean
            totalPrice:
              type: [number, "null"]
            paxCount:
              type: [number, "null"]
            flightDetails:
              type: object
              properties:
                flightNumber:
                  type: string
                arrivalDateTime:
                  type: string
                departureFlightNumber:
                  type: [string, "null"]
                departureDateTime:
                  type: [string, "null"]
              required:
                - flightNumber
                - arrivalDateTime
          required:
            - flightDetails
        excursions:
          type: ["null", object]
          properties:
            totalAmount:
              type: number
            selections:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  name:
                    type: [string, "null"]
                  quantityAdult:
                    type: [number, "null"]
                  quantityChild:
                    type: [number, "null"]
                  priceAdult:
                    type: [number, "null"]
                  priceChild:
                    type: [number, "null"]
                  currency:
                    type: [string, "null"]
                  totalPrice:
                    type: [number, "null"]
                required:
                  - id
          required:
            - totalAmount
            - selections
        insurance:
          oneOf:
            - type: "null"
            - $ref: "#/components/schemas/HotelsBookInsuranceInput"
        airTickets:
          type: [object, "null"]
          additionalProperties: true
        acknowledgePriceChange:
          type: boolean
      required:
        - hotelCode
        - destinationCode
        - rooms
    HotelsBookRoomResult:
      type: object
      properties:
        roomIdentifier:
          type: [integer, "null"]
        rateKey:
          type: [string, "null"]
        status:
          type: [string, "null"]
      required:
        - roomIdentifier
        - rateKey
        - status
    HotelsBookResponse:
      type: object
      properties:
        sessionId:
          type: string
        status:
          type: [string, "null"]
        hotelConfirmationNumber:
          type: [string, "null"]
        adsConfirmationNumber:
          type: [string, "null"]
        supplierConfirmationNumber:
          type: [string, "null"]
        customerRefNumber:
          type: [string, "null"]
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/HotelsBookRoomResult"
        services:
          type: object
          properties:
            transfer:
              $ref: "#/components/schemas/B2bBookedService"
            excursions:
              allOf:
                - $ref: "#/components/schemas/B2bBookedService"
                - type: object
                  properties:
                    items:
                      type: [number, "null"]
            insurance:
              type: object
              properties:
                status:
                  type: string
                  enum:
                    - skipped
                    - booked
                    - failed
                referenceId:
                  type: [string, "null"]
                message:
                  type: [string, "null"]
                provider:
                  type: [string, "null"]
                policies:
                  type: [array, "null"]
                  items:
                    type: object
                    properties:
                      travelerId:
                        type: [string, "null"]
                      response:
                        type: object
                        additionalProperties: true
                    required:
                      - travelerId
                      - response
              required:
                - status
                - referenceId
                - message
                - provider
                - policies
      required:
        - sessionId
        - rooms
    B2bBookedService:
      type: object
      properties:
        status:
          type: string
          enum:
            - skipped
            - booked
            - failed
        referenceId:
          type: [string, "null"]
        message:
          type: [string, "null"]
      required:
        - status
        - referenceId
        - message
    HotelSearchRequest:
      type: object
      properties:
        destinationCode:
          type: string
          description: Supplier destination code, usually in `<number>-0` format.
          examples:
            - "160-0"
        hotelCode:
          type: string
        countryCode:
          type: string
          default: AE
        nationality:
          type: string
          default: AM
        currency:
          type: string
          default: USD
        checkInDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        checkOutDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        rooms:
          type: array
          items:
            $ref: "#/components/schemas/Room"
      required:
        - checkInDate
        - checkOutDate
    HotelSummary:
      type: object
      properties:
        code:
          type: [string, "null"]
        name:
          type: [string, "null"]
        minPrice:
          type: [number, "null"]
        currency:
          type: [string, "null"]
        rating:
          type: [number, "null"]
        address:
          type: [string, "null"]
        city:
          type: [string, "null"]
        imageUrl:
          type: [string, "null"]
        latitude:
          type: [number, "null"]
        longitude:
          type: [number, "null"]
    Destination:
      type: object
      properties:
        destinationCode:
          type: string
          example: "160-0"
        name:
          type: string
          example: Dubai
      required:
        - destinationCode
        - name
    DestinationLookupResponse:
      type: object
      properties:
        countryCode:
          type: string
          example: AE
        count:
          type: integer
          example: 20
        destinations:
          type: array
          items:
            $ref: "#/components/schemas/Destination"
      required:
        - countryCode
        - count
        - destinations
    TransferRate:
      type: object
      additionalProperties: true
      description: Transfer rate object from Megatours transfer inventory.
    TransferFacets:
      type: object
      properties:
        transferTypes:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        chargeTypes:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        vehicleCategories:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        priceRange:
          type: object
          properties:
            minOneWay:
              type: [number, "null"]
            maxOneWay:
              type: [number, "null"]
            currency:
              type: [string, "null"]
          required:
            - minOneWay
            - maxOneWay
            - currency
      required:
        - transferTypes
        - chargeTypes
        - vehicleCategories
        - priceRange
    TransfersSearchRequest:
      type: object
      properties:
        destinationLocationCode:
          type: [string, "null"]
          example: "160-0"
        destinationName:
          type: [string, "null"]
          example: Dubai
        transferType:
          type: [string, "null"]
          enum:
            - INDIVIDUAL
            - GROUP
        paxCount:
          type: [number, "null"]
        travelDate:
          type: [string, "null"]
      description: destinationLocationCode or destinationName is required.
    TransfersSearchResponse:
      type: object
      properties:
        destinationLocationCode:
          type: [string, "null"]
        destinationName:
          type: [string, "null"]
        transfers:
          type: array
          items:
            $ref: "#/components/schemas/TransferRate"
        facets:
          $ref: "#/components/schemas/TransferFacets"
      required:
        - transfers
        - facets
    ExcursionTicket:
      type: object
      additionalProperties: true
      description: Excursion object from Megatours excursion inventory.
    ExcursionFacets:
      type: object
      properties:
        productTypes:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        cities:
          type: array
          items:
            $ref: "#/components/schemas/FacetItem"
        priceRange:
          type: object
          properties:
            minAdult:
              type: [number, "null"]
            maxAdult:
              type: [number, "null"]
            currency:
              type: [string, "null"]
          required:
            - minAdult
            - maxAdult
            - currency
      required:
        - productTypes
        - cities
        - priceRange
    ExcursionsSearchRequest:
      type: object
      properties:
        limit:
          type: integer
          minimum: 1
          maximum: 200
          default: 200
    ExcursionsSearchResponse:
      type: object
      properties:
        count:
          type: integer
        excursionFee:
          type: number
        excursions:
          type: array
          items:
            $ref: "#/components/schemas/ExcursionTicket"
        facets:
          $ref: "#/components/schemas/ExcursionFacets"
      required:
        - count
        - excursionFee
        - excursions
        - facets
    HotelSearchResponse:
      type: object
      properties:
        currency:
          type: [string, "null"]
        propertyCount:
          type: [integer, "null"]
        responseTime:
          type: [string, "null"]
        destination:
          type: [object, "null"]
          properties:
            code:
              type: [string, "null"]
            name:
              type: [string, "null"]
        hotels:
          type: array
          items:
            $ref: "#/components/schemas/HotelSummary"
    HotelsBookInsuranceAddressInput:
      type: object
      description: Traveler registration address fields collected from partner UI inputs.
      properties:
        full:
          type: string
        fullEn:
          type: [string, "null"]
        country:
          type: string
        countryId:
          type: [string, "null"]
        region:
          type: string
        city:
          type: string
      required:
        - full
        - country
        - region
        - city
    HotelsBookInsuranceTravelerInput:
      type: object
      description: Insurance traveler details collected from partner UI inputs.
      properties:
        id:
          type: [string, "null"]
        firstName:
          type: string
        lastName:
          type: string
        firstNameEn:
          type: [string, "null"]
        lastNameEn:
          type: [string, "null"]
        gender:
          type: string
          enum:
            - M
            - F
        birthDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        residency:
          type: boolean
        socialCard:
          type: [string, "null"]
        passportNumber:
          type: string
        passportAuthority:
          type: string
        passportIssueDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        passportExpiryDate:
          type: string
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        mobilePhone:
          type: string
        phone:
          type: [string, "null"]
        email:
          type: string
          format: email
        citizenship:
          type: string
        premium:
          type: number
        premiumCurrency:
          type: string
        policyPremium:
          type: [number, "null"]
        subrisks:
          type: array
          items:
            type: string
        address:
          $ref: "#/components/schemas/HotelsBookInsuranceAddressInput"
      required:
        - firstName
        - lastName
        - gender
        - birthDate
        - residency
        - passportNumber
        - passportAuthority
        - passportIssueDate
        - passportExpiryDate
        - mobilePhone
        - email
        - citizenship
        - premium
        - premiumCurrency
        - address
    HotelsBookInsuranceInput:
      type: object
      description: |
        EFES policy issuance payload for `/v1/hotels/book`.
        Partners should send traveler fields captured from UI inputs.
        Internal/defaulted EFES fields are resolved server-side.
      properties:
        provider:
          type: [string, "null"]
          enum:
            - efes
            - null
          default: efes
        planId:
          type: [string, "null"]
          description: Optional partner-side plan reference. Defaults to `efes-travel` if omitted.
        planName:
          type: [string, "null"]
        planLabel:
          type: [string, "null"]
        note:
          type: [string, "null"]
        startDate:
          type: [string, "null"]
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          description: Optional. Defaults to booking check-in date.
        endDate:
          type: [string, "null"]
          pattern: "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
          description: Optional. Defaults to booking check-out date.
        days:
          type: [number, "null"]
          description: Optional. Calculated from dates when omitted.
        territoryCode:
          type: string
          description: EFES territory code selected by partner from quote flow.
        riskAmount:
          type: number
        riskCurrency:
          type: string
        riskLabel:
          type: [string, "null"]
          description: Optional override. Defaults server-side.
        territoryLabel:
          type: [string, "null"]
          description: Optional override. Defaults server-side.
        territoryPolicyLabel:
          type: [string, "null"]
          description: Optional override. Defaults server-side.
        travelCountries:
          type: [string, "null"]
          description: Optional override. Defaults server-side.
        subrisks:
          type: array
          items:
            type: string
        price:
          type: [number, "null"]
          description: Optional total premium. Used as fallback if traveler premium is not provided.
        currency:
          type: [string, "null"]
        travelers:
          type: array
          items:
            $ref: "#/components/schemas/HotelsBookInsuranceTravelerInput"
      required:
        - territoryCode
        - riskAmount
        - riskCurrency
        - travelers
      additionalProperties: true
    InsuranceTraveler:
      type: object
      properties:
        id:
          type: [string, "null"]
        age:
          type: number
        passportNumber:
          type: [string, "null"]
        socialCard:
          type: [string, "null"]
        subrisks:
          type: array
          items:
            type: string
      required:
        - age
    InsuranceQuoteRequest:
      type: object
      properties:
        startDate:
          type: string
        endDate:
          type: string
        days:
          type: [number, "null"]
        territoryCode:
          type: string
        riskAmount:
          type: number
        riskCurrency:
          type: string
        riskLabel:
          type: [string, "null"]
        promoCode:
          type: [string, "null"]
        travelers:
          type: array
          items:
            $ref: "#/components/schemas/InsuranceTraveler"
        subrisks:
          type: array
          items:
            type: string
      required:
        - startDate
        - endDate
        - territoryCode
        - riskAmount
        - riskCurrency
        - travelers
    InsuranceQuoteResponse:
      type: object
      properties:
        totalPremium:
          type: number
        currency:
          type: string
        premiums:
          type: array
          items:
            type: object
            properties:
              travelerId:
                type: [string, "null"]
              premium:
                type: number
            required:
              - premium
        sum:
          type: [number, "null"]
        discountedSum:
          type: [number, "null"]
        sumByTraveler:
          type: [object, "null"]
          additionalProperties:
            type: number
        discountedSumByTraveler:
          type: [object, "null"]
          additionalProperties:
            type: number
        priceCoverages:
          type: [object, "null"]
          additionalProperties:
            type: number
        discountedPriceCoverages:
          type: [object, "null"]
          additionalProperties:
            type: number
        priceCoveragesByTraveler:
          type: [object, "null"]
          additionalProperties:
            type: object
            additionalProperties:
              type: number
        discountedPriceCoveragesByTraveler:
          type: [object, "null"]
          additionalProperties:
            type: object
            additionalProperties:
              type: number
